<%= form_for([@course, @team]) do |f| %>
    <% if @team.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@team.errors.count, "error") %> prohibited this team from being saved:</h2>

          <ul>
            <% @team.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>
    <div class="rounded staff">
      <%= professor_image %>
      <span class="instructions">These fields can be edited by faculty.</span>
      <% if !(current_user.is_admin? || current_user.is_staff?) %>
          <%= render :partial => 'show_faculty_fields' %>
      <% else %>

          <p>
            <%= f.label :name, "Team name" %> (*)<br/>
            <%= f.text_field :name, :size => 40 %>
          </p>


          <p>
            <%= f.label :section %><br/>
            <%= f.text_field :section %><br/>
          </p>

          <table class="layout_table">
            <tbody>
            <tr>
              <td><%= f.label :primary_faculty_id, "Primary faculty" %>
                <br/></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>Label for primary faculty (ie Coach, VP of Engineering)</td>
            </tr>
            <tr>
              <td><%= f.collection_select(:primary_faculty_id, @faculty, :id, :human_name, :include_blank => true) %></td>
              <td><%= link_to "Add Instructor", edit_course_path(@course) %></td>
              <td>&nbsp;</td>
              <td><%= text_field_tag :primary_faculty_label, @course.primary_faculty_label, :size => 20 %>
                <i>(affects all teams in this course)</i></td>
            </tr>
            </tbody>
          </table>
          <br/>

          <div id="people_in_a_collection">
            <p>Team members</p>
            <% if @team.members_override.nil? %>
                <%= render :partial => '/people/person_in_a_collection', :collection => @team.members.map(&:human_name), :as => :person, :locals => {:collection_form => f, :member_label => "Person"} %>
            <% else %>
                <%= render :partial => '/people/person_in_a_collection', :collection => @team.members_override, :as => :person, :locals => {:collection_form => f, :member_label => "Person"} %>
            <% end %>

          </div>

          <div class="formItem indented"><p><%= link_to "Add a team member", "#", :id => "add_person" %></p></div>


<%# content_for :javascript do %>
          <%# javascript_tag do %>
          <script type="text/javascript">
              $(function () {
                  $("#add_person").click(function () {
                      $("#people_in_a_collection").append("<%= escape_javascript(render(:partial => '/people/person_in_a_collection', :object => Person.new, :locals => { :member_label => "Person"} )) %>");
                  });

              });
          </script>
          <%# end %>
<%# end %>

      <% end %>
    </div>
    <div class="rounded admin">
      <%= admin_image %>
      <span class="instructions">These fields can be edited by admin.</span>
      <% if !(current_user.is_admin?) %>
          <%= render :partial => 'show_admin_fields' %>
      <% else %>
          <p>
            <%= f.label :twiki_space, "TWiki space" %><br/>
            <%= f.text_field :twiki_space, :size => 90 %><br/>
            <span class="help_text">Email twiki@sv.cmu.edu once all of your students have selected team names. </span>
          </p>
      <% end %>
    </div>
    <div class="rounded system">
      <p>
        Email (autogenerated)<br/>
        <%= f.text_field :email, :size => 90, :readonly => true %><br/>
        <span class="help_text">Distribution lists for each team are created by the system once a team name is provided.</span>
      </p>
    </div>
    <br/>
    <p>
      <%= f.submit button_name %>
    </p>
<% end %>